{"ast":null,"code":"import { path } from \"d3-path\";\nimport { slice } from \"./array.js\";\nimport constant from \"./constant.js\";\nimport { abs, cos, epsilon, halfPi, sin } from \"./math.js\";\nfunction defaultSource(d) {\n  return d.source;\n}\nfunction defaultTarget(d) {\n  return d.target;\n}\nfunction defaultRadius(d) {\n  return d.radius;\n}\nfunction defaultStartAngle(d) {\n  return d.startAngle;\n}\nfunction defaultEndAngle(d) {\n  return d.endAngle;\n}\nfunction defaultPadAngle() {\n  return 0;\n}\nfunction defaultArrowheadRadius() {\n  return 10;\n}\nfunction ribbon(headRadius) {\n  var source = defaultSource,\n    target = defaultTarget,\n    sourceRadius = defaultRadius,\n    targetRadius = defaultRadius,\n    startAngle = defaultStartAngle,\n    endAngle = defaultEndAngle,\n    padAngle = defaultPadAngle,\n    context = null;\n  function ribbon() {\n    var buffer,\n      s = source.apply(this, arguments),\n      t = target.apply(this, arguments),\n      ap = padAngle.apply(this, arguments) / 2,\n      argv = slice.call(arguments),\n      sr = +sourceRadius.apply(this, (argv[0] = s, argv)),\n      sa0 = startAngle.apply(this, argv) - halfPi,\n      sa1 = endAngle.apply(this, argv) - halfPi,\n      tr = +targetRadius.apply(this, (argv[0] = t, argv)),\n      ta0 = startAngle.apply(this, argv) - halfPi,\n      ta1 = endAngle.apply(this, argv) - halfPi;\n    if (!context) context = buffer = path();\n    if (ap > epsilon) {\n      if (abs(sa1 - sa0) > ap * 2 + epsilon) sa1 > sa0 ? (sa0 += ap, sa1 -= ap) : (sa0 -= ap, sa1 += ap);else sa0 = sa1 = (sa0 + sa1) / 2;\n      if (abs(ta1 - ta0) > ap * 2 + epsilon) ta1 > ta0 ? (ta0 += ap, ta1 -= ap) : (ta0 -= ap, ta1 += ap);else ta0 = ta1 = (ta0 + ta1) / 2;\n    }\n    context.moveTo(sr * cos(sa0), sr * sin(sa0));\n    context.arc(0, 0, sr, sa0, sa1);\n    if (sa0 !== ta0 || sa1 !== ta1) {\n      if (headRadius) {\n        var hr = +headRadius.apply(this, arguments),\n          tr2 = tr - hr,\n          ta2 = (ta0 + ta1) / 2;\n        context.quadraticCurveTo(0, 0, tr2 * cos(ta0), tr2 * sin(ta0));\n        context.lineTo(tr * cos(ta2), tr * sin(ta2));\n        context.lineTo(tr2 * cos(ta1), tr2 * sin(ta1));\n      } else {\n        context.quadraticCurveTo(0, 0, tr * cos(ta0), tr * sin(ta0));\n        context.arc(0, 0, tr, ta0, ta1);\n      }\n    }\n    context.quadraticCurveTo(0, 0, sr * cos(sa0), sr * sin(sa0));\n    context.closePath();\n    if (buffer) return context = null, buffer + \"\" || null;\n  }\n  if (headRadius) ribbon.headRadius = function (_) {\n    return arguments.length ? (headRadius = typeof _ === \"function\" ? _ : constant(+_), ribbon) : headRadius;\n  };\n  ribbon.radius = function (_) {\n    return arguments.length ? (sourceRadius = targetRadius = typeof _ === \"function\" ? _ : constant(+_), ribbon) : sourceRadius;\n  };\n  ribbon.sourceRadius = function (_) {\n    return arguments.length ? (sourceRadius = typeof _ === \"function\" ? _ : constant(+_), ribbon) : sourceRadius;\n  };\n  ribbon.targetRadius = function (_) {\n    return arguments.length ? (targetRadius = typeof _ === \"function\" ? _ : constant(+_), ribbon) : targetRadius;\n  };\n  ribbon.startAngle = function (_) {\n    return arguments.length ? (startAngle = typeof _ === \"function\" ? _ : constant(+_), ribbon) : startAngle;\n  };\n  ribbon.endAngle = function (_) {\n    return arguments.length ? (endAngle = typeof _ === \"function\" ? _ : constant(+_), ribbon) : endAngle;\n  };\n  ribbon.padAngle = function (_) {\n    return arguments.length ? (padAngle = typeof _ === \"function\" ? _ : constant(+_), ribbon) : padAngle;\n  };\n  ribbon.source = function (_) {\n    return arguments.length ? (source = _, ribbon) : source;\n  };\n  ribbon.target = function (_) {\n    return arguments.length ? (target = _, ribbon) : target;\n  };\n  ribbon.context = function (_) {\n    return arguments.length ? (context = _ == null ? null : _, ribbon) : context;\n  };\n  return ribbon;\n}\nexport default function () {\n  return ribbon();\n}\nexport function ribbonArrow() {\n  return ribbon(defaultArrowheadRadius);\n}","map":null,"metadata":{},"sourceType":"module"}